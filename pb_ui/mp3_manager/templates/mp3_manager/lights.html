{% extends "./base.html" %}
{% load crispy_forms_tags %}

{% block content %}
  <div class="row">
    <div class="col">
      <a href="/"><button type="button" class="btn btn-secondary">Play Mode</button></a>&nbsp;
      <a href="/tracks"><button type="button" class="btn btn-secondary">Track Management</button></a>&nbsp;
      <a href="/playlists"><button type="button" class="btn btn-secondary">Playlist Management</button></a>
      <a href="/lights"><button type="button" class="btn btn-success">Light Management</button></a>
    </div>
  </div>
  
  <hr>
  <div class="row">
    <div class="col">
      <h2>Brightness</h2>
      {% if form_errors %}
      <div class="alert">{{ form_errors }}</div>
    {% endif %}
      <form id="brightness_form" name="brightness_form" action={% url 'mp3_manager:bridge' %} method="post" enctype="multipart/form-data">
      {% csrf_token %}

      {{ brightnessform|crispy }}
      <input class="btn btn-secondary" type="submit" form="brightness_form" value="Update" id="brightness_update" name="brightness_update"></input>
      </form>
    </div>
  </div>

  <hr>
  <div class="row">
    <div class="col">
      <h2>Light Config</h2>
      {% if lights %}
      <table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
        <thead>
          <tr><th></th><th colspan="2">Light Colours</th><th colspan="2"></th><th colspan="4">Colour Mode</th><th></th></tr>
          <tr><th>Name</th><th>Primary RGB</th><th>Secondary RGB</th><th>Interval (beats)</th><th></th><th>Primary Only</th><th>Alternate</th><th>Fade Between</th><th>Randomise</th><th>Randomise Interval</th></tr>
        </thead>
        <tbody>
          {% for light in lights %}
            <tr>
              <form id="light_form_{{ light.pk }}" id="light_update_{ light.pk }}" action={% url 'mp3_manager:lights' %} method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <td>{{ light.name }}</td>
              <td style="background: rgb({{ light.primary_R }},{{ light.primary_G }},{{ light.primary_B }});">
                <input size="4" type="textarea" id="primary_R" name="primary_R" value={{ light.primary_R }}>
                <input size="4" type="textarea" id="primary_G" name="primary_G" value={{ light.primary_G }}>
                <input size="4" type="textarea" id="primary_B" name="primary_B" value={{ light.primary_B }}>
              </td>
              <td style="background: rgb({{ light.secondary_R }},{{ light.secondary_G }},{{ light.secondary_B }});">
                <input size="4" type="textarea" id="secondary_R" name="secondary_R" value={{ light.secondary_R }}>
                <input size="4" type="textarea" id="secondary_G" name="secondary_G" value={{ light.secondary_G }}>
                <input size="4" type="textarea" id="secondary_B" name="secondary_B" value={{ light.secondary_B }}>
              </td>
              <td>
                <input size="4" type="textarea" id="interval_size" name="interval_size" value={{ light.interval_size }}>
              </td>
              <td>
                <input type="hidden" id="pk" name="pk" value="{{ light.pk }}">
                <input class="btn btn-secondary" type="submit" form="light_form_{{ light.pk }}" value="Update" name="light_update_{{ light.pk }}">
              </td>
              </form>
              
              <td>
                {% if light.primary_colour %}
                  <a href="{% url 'mp3_manager:lightprimary' pk=light.pk %}"><button type="button" class="btn btn-success">On</button></a>
                {% else %}
                  <a href="{% url 'mp3_manager:lightprimary' pk=light.pk %}"><button type="button" class="btn btn-secondary">Off</button></a>
                {% endif %}
              </td>
              
              <td>
                {% if light.alternate_colour %}
                  <a href="{% url 'mp3_manager:lightalternate' pk=light.pk %}"><button type="button" class="btn btn-success">On</button></a>
                {% else %}
                  <a href="{% url 'mp3_manager:lightalternate' pk=light.pk %}"><button type="button" class="btn btn-secondary">Off</button></a>
                {% endif %}
              </td>
              
              <td>
                {% if light.fade %}
                  <a href="{% url 'mp3_manager:lightfade' pk=light.pk %}"><button type="button" class="btn btn-success">On</button></a>
                {% else %}
                  <a href="{% url 'mp3_manager:lightfade' pk=light.pk %}"><button type="button" class="btn btn-secondary">Off</button></a>
                {% endif %}
              </td>
              
              <td>
                {% if light.random_colour %}
                  <a href="{% url 'mp3_manager:lightrandom' pk=light.pk %}"><button type="button" class="btn btn-success">On</button></a>
                {% else %}
                  <a href="{% url 'mp3_manager:lightrandom' pk=light.pk %}"><button type="button" class="btn btn-secondary">Off</button></a>
                {% endif %}
              </td>
              <td>
                {% if light.random_interval %}
                  <a href="{% url 'mp3_manager:lightinterval' pk=light.pk %}"><button type="button" class="btn btn-success">On</button></a>
                {% else %}
                  <a href="{% url 'mp3_manager:lightinterval' pk=light.pk %}"><button type="button" class="btn btn-secondary">Off</button></a>
                {% endif %}

              </td>

            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endif %}
    </div>
  </div>
  
  <hr>
  <div class="row">
    <div class="col">
      <h2>Bridge Settings</h2>
      {% if form_errors %}
        <div class="alert">{{ form_errors }}</div>
      {% endif %}
        <form id="bridge_form" name="bridge_form" action={% url 'mp3_manager:bridge' %} method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {{ bridgeform|crispy }}
        <input class="btn btn-danger" type="submit" form="bridge_form" value="RESET LIGHTS" id="bridge_reset" name="bridge_reset"></input>
        </form>
    </div>
  </div>

{% endblock %}